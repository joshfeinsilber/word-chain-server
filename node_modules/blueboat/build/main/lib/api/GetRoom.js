"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const PubSubListeners_1 = require("../constants/PubSubListeners");
const GetRoom = (req, res) => {
    let hasSent = false;
    try {
        const gameServer = req.gameServer;
        // @ts-ignore
        const listener = gameServer.pubsub.on(PubSubListeners_1.REQUEST_INFO, info => {
            res.send(JSON.parse(JSON.stringify(info)));
            hasSent = true;
            listener.unsubscribe();
        });
        // @ts-ignore
        gameServer.pubsub.publish(req.params.room, { action: PubSubListeners_1.REQUEST_INFO });
        setTimeout(() => {
            if (!hasSent) {
                listener.unsubscribe();
                res.status(404).send('No room found');
            }
        }, 5000);
    }
    catch (e) {
        if (!hasSent) {
            res.status(404).send('Error sending room');
        }
    }
};
exports.default = GetRoom;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR2V0Um9vbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvYXBpL0dldFJvb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxrRUFBMkQ7QUFHM0QsTUFBTSxPQUFPLEdBQUcsQ0FBQyxHQUFRLEVBQUUsR0FBUSxFQUFFLEVBQUU7SUFDckMsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFBO0lBQ25CLElBQUk7UUFDRixNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsVUFBb0IsQ0FBQTtRQUMzQyxhQUFhO1FBQ2IsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsOEJBQVksRUFBRSxJQUFJLENBQUMsRUFBRTtZQUN6RCxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDMUMsT0FBTyxHQUFHLElBQUksQ0FBQTtZQUNkLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtRQUN4QixDQUFDLENBQUMsQ0FBQTtRQUNGLGFBQWE7UUFDYixVQUFVLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSw4QkFBWSxFQUFFLENBQUMsQ0FBQTtRQUNwRSxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDWixRQUFRLENBQUMsV0FBVyxFQUFFLENBQUE7Z0JBQ3RCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFBO2FBQ3RDO1FBQ0gsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO0tBQ1Q7SUFBQyxPQUFPLENBQUMsRUFBRTtRQUNWLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFBO1NBQzNDO0tBQ0Y7QUFDSCxDQUFDLENBQUE7QUFFRCxrQkFBZSxPQUFPLENBQUEifQ==